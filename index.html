<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Rastreamento de Hex Codes</title>
</head>
<body>
  <h1>Aviões rastreados</h1>
  <ul id="listaAvioes"></ul>

  <script>
    async function carregarHexCodes() {
      const resposta = await fetch('hexCodes.json');
      const dados = await resposta.json();
      return dados.hexCodes;
    }

    async function buscarAvioes(hexCodes) {
      const url = 'https://adsbexchange-com1.p.rapidapi.com/v2/lat/39.6760/lon/-8.1498/dist/100/';
      const opcoes = {
        method: 'GET',
        headers: {
          'X-RapidAPI-Key': 'dbcf86698cmshd04b1b46934dd15p11474ejsn267bbdb81678',
          'X-RapidAPI-Host': 'adsbexchange-com1.p.rapidapi.com'
        }
      };

      const resposta = await fetch(url, opcoes);
      const dados = await resposta.json();
      const todosAvioes = dados.ac || [];

      // Filtrar pelos hex codes
      return todosAvioes.filter(aviao => hexCodes.includes(aviao.hex.toUpperCase()));
    }

    async function mostrarAvioes() {
      const hexCodes = await carregarHexCodes();
      const avioesFiltrados = await buscarAvioes(hexCodes);

      const lista = document.getElementById('listaAvioes');
      lista.innerHTML = '';

      if (avioesFiltrados.length === 0) {
        lista.innerHTML = '<li>Nenhum avião rastreado encontrado na área.</li>';
        return;
      }

      avioesFiltrados.forEach(aviao => {
        const item = document.createElement('li');
        item.textContent = `Hex: ${aviao.hex} | ICAO: ${aviao.icao || 'N/A'} | Altitude: ${aviao.alt_baro || 'N/A'} ft`;
        lista.appendChild(item);
      });
    }

    mostrarAvioes();
  </script>
</body>
</html>